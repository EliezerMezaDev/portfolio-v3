---
import Layout from "@/layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import esTranslations from "@/content/i18n/es.json";
import enTranslations from "@/content/i18n/en.json";

const { lang } = Astro.params;

if (lang !== "es" && lang !== "en") {
  return new Response(null, { status: 404, statusText: "Not Found" });
}

const t = lang === "es" ? esTranslations : enTranslations;
const { title, paragraph_1, paragraph_2, cta_cv } = t.about_page;

const cvPath = lang === "es" ? "/docs/emz-cv-es.pdf" : "/docs/emz-cv-en.pdf";
---

<Layout t={t} lang={lang} showFooter={true}>
  <section id="about-page" class="min-h-screen py-20 md:py-32">
    <div class="container mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-12 items-start">
        <div class="text-content">
          <a
            href={`/${lang}/`}
            class="inline-flex items-center gap-2 text-brand-light/70 hover:text-accent transition-colors mb-8"
          >
            <Icon name="lucide:arrow-left" class="size-4" />
            {t.about_page.back_to_home}
          </a>

          <h1
            class="text-4xl md:text-5xl font-bold text-brand-light tracking-tighter mb-8 opacity-0 translate-y-8"
            data-about-title
          >
            {title}
          </h1>

          <div class="text-lg text-brand-light/80 space-y-6" data-about-text>
            <p class="opacity-0 translate-y-8" data-about-p>{paragraph_1}</p>
            <p class="opacity-0 translate-y-8" data-about-p>{paragraph_2}</p>
          </div>
        </div>

        <div
          class="image-container relative w-full max-w-xs mx-auto lg:mx-0 opacity-0 scale-95"
          data-about-image
        >
          <div
            class="absolute -top-4 -left-4 w-full h-full border-2 border-accent rounded-lg -z-10"
          >
          </div>
          <img
            src="/images/me.webp"
            alt="portrait"
            class="w-full h-auto rounded-lg"
          />

          <div class="mt-4 mb-8">
            <a
              href={cvPath}
              download={`emz-cv.pdf`}
              class="inline-flex items-center justify-center gap-2 w-full px-5 py-3 border-2 border-accent text-accent font-mono text-lg rounded hover:bg-accent/20 transition-all duration-300"
            >
              <Icon name="lucide:download" class="size-5" />
              {cta_cv}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  import { animate, stagger } from "motion";

  function animateAboutPage() {
    const title = document.querySelector("[data-about-title]");
    const paragraphs = document.querySelectorAll("[data-about-p]");
    const image = document.querySelector("[data-about-image]");

    if (!title || !paragraphs.length || !image) return;

    const titleAnim = animate(
      title,
      { opacity: 1, transform: "translateY(-8px)" },
      { duration: 0.5, delay: 0.5, ease: "easeOut" }
    );

    const textAnim = animate(
      paragraphs,
      { opacity: 1, transform: "translateY(-8px)" },
      {
        duration: 0.5,
        delay: stagger(0.25, { startDelay: 0.75 }),
        ease: "easeOut",
      }
    );

    const imageAnim = animate(
      image,
      { opacity: 1, transform: "translateY(-8px)" },
      { duration: 1, delay: 0.5, ease: "easeOut" }
    );

    Promise.all([
      titleAnim.finished,
      textAnim.finished,
      imageAnim.finished,
    ]).then(() => {
      title.classList.remove("opacity-0", "translate-y-8");
      paragraphs.forEach((p) =>
        p.classList.remove("opacity-0", "translate-y-5")
      );
      image.classList.remove("opacity-0", "scale-90");
    });
  }

  document.addEventListener("astro:page-load", animateAboutPage);
</script>
