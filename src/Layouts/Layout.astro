---
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { ClientRouter } from "astro:transitions";
import { Icon } from "astro-icon/components";
import "../styles/global.css";

export interface Props {
  t: Record<string, any>;
  lang: "es" | "en";
  showFooter: boolean;
}

const { t, lang, showFooter = false } = Astro.props;
const info = t.personal_info;
---

<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{t.site?.title}</title>
    <ClientRouter />
  </head>
  <body class="bg-brand-darker text-brand-light font-sans antialiased">
    <Header t={t} lang={lang} />

    {
      showFooter === true && (
        <div class="hidden lg:flex fixed bottom-0 left-8 xl:left-12 flex-col items-center gap-6 z-20">
          <a
            href={info.social_links.github}
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
            class="text-brand-light/60 hover:text-accent hover:-translate-y-1 transition-all"
          >
            <Icon name="lucide:github" class="size-6" />
          </a>
          <a
            href={info.social_links.linkedin}
            target="_blank"
            rel="noopener noreferrer"
            aria-label="LinkedIn"
            class="text-brand-light/60 hover:text-accent hover:-translate-y-1 transition-all"
          >
            <Icon name="lucide:linkedin" class="size-6" />
          </a>
          <div class="w-px h-24 bg-brand-light/40" />
        </div>
      )
    }

    {
      showFooter === true && (
        <div class="hidden lg:flex fixed bottom-0 right-8 xl:right-12 flex-col items-center gap-6 z-20">
          <a
            href={`mailto:${info.email}`}
            class="font-mono text-sm tracking-widest text-brand-light/60 hover:text-accent hover:-translate-y-1 transition-all"
            style="writing-mode: vertical-rl;"
          >
            {info.email}
          </a>
          <div class="w-px h-24 bg-brand-light/40" />
        </div>
      )
    }

    <main>
      <slot />
    </main>
    {
      showFooter === true && (
        <Footer
          t={{
            footer: {
              copyright: t.footer.copyright,
            },
            personal_info: {
              name: t.personal_info.name,
              social_links: {
                linkedin: t.personal_info.social_links.linkedin,
                github: t.personal_info.social_links.github,
              },
            },
          }}
        />
      )
    }
  </body>
</html>

<script>
  import { animate } from "motion";

  function setupGlobalInteractions() {
    const header = document.querySelector("#main-header");

    if (!header) return;

    let lastScrollY = window.scrollY;

    window.addEventListener("scroll", () => {
      const currentScrollY = window.scrollY;

      if (currentScrollY > 100) {
        header.classList.add("is-scrolled");
      } else {
        header.classList.remove("is-scrolled");
      }

      if (
        currentScrollY > lastScrollY &&
        currentScrollY > header.clientHeight
      ) {
        animate(header, { y: "-100%" }, { duration: 0.3, ease: "easeInOut" });
      } else if (currentScrollY < lastScrollY) {
        animate(header, { y: "0%" }, { duration: 0.3, ease: "easeInOut" });
      }

      lastScrollY = currentScrollY;
    });

    window.addEventListener("mousemove", (e) => {
      if (e.clientY < 80) {
        animate(header, { y: "0%" }, { duration: 0.3, ease: "easeOut" });
      }
    });

    const lang = document.documentElement.lang;
    document.querySelectorAll('a[href*="#"]').forEach((link) => {
      link.addEventListener("click", (e) => {
        const href = link.getAttribute("href");
        if (href && (href.startsWith("#") || href.startsWith(`/${lang}/#`))) {
          e.preventDefault();

          const targetId = `#${href.split("#")[1]}`;
          const targetElement = document.querySelector(targetId);
          if (!targetElement) return;

          const headerOffset = 100;
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition =
            elementPosition + window.scrollY - headerOffset;

          animate(
            document.documentElement,
            { scrollTop: offsetPosition },
            { duration: 1.2, ease: "easeInOut" }
          );
        }
      });
    });
  }

  document.addEventListener("astro:page-load", setupGlobalInteractions);
</script>
